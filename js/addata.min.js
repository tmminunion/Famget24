async function fetchData(){try{const t=await fetch("https://api.bungtemin.net/FamgetAbsensi/palsuk"),e=await t.json(),a=document.getElementById("dataTablex").querySelector("tbody");a.innerHTML="",e.forEach((t,e)=>{const n=document.createElement("tr");n.innerHTML=`\n                <td class="text-center"><a href="#" class="btn btn-warning btn-sm">${e+1}</a></td>\n                  <td class="text-center">${t.waktu}</td>\n                <td class="text-left">${t.nama}</td>\n            `,a.appendChild(n)})}catch(t){console.error("Error fetching data:",t)}}function getPar(t){const e=window.location.href;t=t.replace(/[\[\]]/g,"\\$&");const a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=a.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function createGradient(t,e,a){const n=t.createLinearGradient(0,0,0,400);return n.addColorStop(0,e),n.addColorStop(1,a),n}function updateDonutChart(t,e){myDonutChart?(myDonutChart.data.datasets[0].data=[t,e],myDonutChart.update()):myDonutChart=new Chart(ctx1,{type:"doughnut",data:{labels:["Sudah Hadir","Belum Hadir"],datasets:[{data:[t,e],backgroundColor:[createGradient(ctx1,"#2ed8b6","#59e0c5"),createGradient(ctx1,"#ff5370","#ff869a")],borderWidth:1}]},options:{plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(t){const e=t.dataset.data.reduce((t,e)=>t+e,0),a=t.raw,n=(a/e*100).toFixed(2);return`${t.label}: ${a} (${n}%)`}}},datalabels:{formatter:function(t,e){const a=e.chart.data.datasets[0].data.reduce((t,e)=>t+e,0),n=(t/a*100).toFixed(2);return`${t} (${n}%)`},color:"#fff00",font:{weight:"bold",size:16}},centerText:{afterDatasetsDraw:function(t){const e=t.ctx,a=t.chartArea.width,n=t.chartArea.height,r=t.data.datasets[0].data.reduce((t,e)=>t+e,0);e.save(),e.textAlign="center",e.textBaseline="middle",e.font="bold 18px Arial",e.fillStyle="#33300",e.fillText(`Total: ${r}`,a/2,n/2),e.restore()}}}},plugins:[ChartDataLabels]})}function updateChart(t,e){myChart?(myChart.data.datasets[0].data=t,myChart.data.datasets[1].data=e,myChart.update()):myChart=new Chart(ctx,{type:"bar",data:{labels:["Bus 1","Bus 2","Bus 3","Bus 4","Bus 5","Bus 6","Bus 7"],datasets:[{label:"Hadir (%)",data:t,backgroundColor:createGradient(ctx,"#2ed8b6","#59e0c5"),borderWidth:1},{label:"Tidak Hadir (%)",data:e,backgroundColor:createGradient(ctx,"#ff5370","#ff869a"),borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,stacked:!0,title:{display:!0,text:"Persentase Absensi (%)"}},x:{stacked:!0}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(t){return`${t.dataset.label}: ${t.raw}%`}}},datalabels:{anchor:"center",align:"center",formatter:function(t){return t+"%"},color:"white",font:{weight:"bold"}}},responsive:!0,maintainAspectRatio:!1},plugins:[ChartDataLabels]})}import{initializeApp}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";import{getDatabase,ref,onValue}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyA7kHlC_5RxBy7g5JbFuYWjGOZ393S0-hk",authDomain:"nufat-eltijany.firebaseapp.com",databaseURL:"https://nufat-eltijany-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"nufat-eltijany",storageBucket:"nufat-eltijany.appspot.com",messagingSenderId:"816575333917",appId:"1:816575333917:web:58d7f5f399c27b503b28f4",measurementId:"G-BNJ6JMT2JE"},app=initializeApp(firebaseConfig),db=getDatabase(app),Acara=getPar("acara")||1,starCountRef=ref(db,"Famgetabsensi/"+Acara),ctx1=document.getElementById("kehadiranDonut").getContext("2d");let myDonutChart;const ctx=document.getElementById("absensiChart").getContext("2d");let myChart;onValue(starCountRef,t=>{const e=t.val();console.log(e);const a=document.getElementById("dataBody");a.innerHTML="";let n=1;const r=[],s=[];let d=0,o=0;for(const t in e)if(e.hasOwnProperty(t)){var c=parseInt(e[t].Sudah),l=parseInt(e[t].Belum),i=l+c,u=c/i*100,p=parseInt(u),f=100-p;r.push(p),s.push(f),d+=parseInt(e[t].Sudah),o+=parseInt(e[t].Belum);const b=e[t],m=`\n          <tr>\n            <td class="text-center">${n}</td>\n            <td class="text-center">${b.Nama}</td>\n            <td class="text-center">${b.Sum}</td>\n            <td class="text-center">${b.Peserta}</td>\n            <td class="text-center">${b.Sudah}</td>\n            <td class="text-center">${b.Belum}</td>\n            <td class="text-center">${p}%</td>\n            <td class="text-center">\n              <a href="absensi.html?acara=${Acara}&data=${t}" class="btn btn-primary btn-sm">Lihat</a>\n            </td>\n          </tr>\n        `;a.insertAdjacentHTML("beforeend",m),n++}var b=d+o,m=d/b*100,h=document.getElementById("absentotal");h.textContent=b;var g=document.getElementById("data_masuk");g.textContent=d;var x=document.getElementById("data_belum");x.textContent=o;var y=document.getElementById("data_persen");y.textContent=m.toFixed(2)+"%",updateDonutChart(d,o),updateChart(r,s),fetchData()});